<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aqua-tan Smart Light</title>
<link rel="stylesheet" href="./pure.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">
</head>
<body>
<div class="p-m pure-menu-horizontal pure-menu-scrollable pm-fix">
  <a href="#" class="pure-menu-heading"><img width='32' height='32' title='' alt='' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IB2cksfwAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAABnklEQVRYCb2XUVLEMAxDW4b7X7mgwssorp2mtDQzYMeWJcW7fLBs27bo56VzEPp4SVgyEl9/o+77+SSZiAf3xYxEdCKeOib2+6yBSCYBCJX7AVv1HbuMDEDUDdhF/SjCTKzbWJ9W34FZInCwSnhaXEOjDUBEFD4KqnbrZBuQiIu6QFYX/oqxjj8z4IJZLhOVkQw/NBcNAFYkz0hVmzURcbo3bjegopo+gJE28N3341jqzHCPseNyAw7ESCbgOOVgY70TsmbHGf8KsiEGsh4GPDqOHA7z8ZNWG3CgSCDyOjl9MJkYPWZanDHQwBMJQpUJzLa+fwQUIYl6Z33wmhcWvNfJW3x6AxDzUu6KGCLuPd+Ag5/K4zY7cYn81wamH3BlA/E10yIj4JsbOKxfxqoNZOA7G8j49sVkGxA4EytJdqb613ButIHMRC2Td4biGsk2ANXpMMA/Rj1wqzYAp0z4JtyU18HHeIZZRxuIZE/f98ecbSCKnr0o4qt72+RVAxXhTL2JOvjMwJ0Xp4Iurvzud6ASqepRf1lf/Nf8IK7CF5KQSk/UTlbbAAAAAElFTkSuQmCC'></a>
  <ul class="pure-menu-list">
    <li class="pure-menu-item"><a href="#" class="pure-menu-link">Aqua-tan Smart Light</a></li>
  </ul>  
</div>

<div class="l-content">

  <div class="a-t pure-g">

    <div id="led" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-lighting">
        <div class="at-header">
          <h2>LED Light</h2>

          <span class="at-val">
            <div id="ls">--</div><span id="lv">--</span>
          </span>
        </div>
      </div>
    </div>

  </div>
  
  <div id="settings">

    <div id="sec_sch" class="if pure-g">
      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Auto lighting schedule</h3>
          <p>Set the lighting schedule.</p>
          <p>
	    <form id="config" class="pure-form pure-form-stacked">
	      <fieldset>
		<legend>Scheduler</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-1">
		    <input id="enable" value="1" type="checkbox"> Enable
		  </div>
		</div>
		<legend>Turn on time</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="on_h" class="pure-u-22-24" type="text">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="on_m" class="pure-u-22-24" type="text">
		  </div>
		  <div class="pure-u-1 pure-u-md-3-5">
		  </div>
		</div>
		<legend>Turn off time</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="off_h" class="pure-u-22-24" type="text">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="off_m" class="pure-u-22-24" type="text">
		  </div>
		  <div class="pure-u-1 pure-u-md-3-5">
		  </div>
		</div>

		<legend>Maximum LED power (up to 1023)</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="max_power" class="pure-u-22-24" type="text" >
		  </div>
		</div>

		<legend>Turn on/off duration (seconds: 0 is immediate.)</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="dim" class="pure-u-22-24" type="text" >
		  </div>
		</div>

		<button id="sch_sub" type="submit" class="pure-button pure-button-primary">Submit</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
        </div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Reset WiFi settings</h3>
          <p>Reset the WiFi AP setting by clicking this button.</p>
	  <p>
	    <form action="/wifireset" class="pure-form pure-form-stacked">
	      <fieldset>
		<button type="submit" class="btn-red pure-button">Reset</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Reset ALL settings</h3>
          <p>Reset the ALL setting by clicking this button.</p>
	  <p>
	    <form action="/reset" class="pure-form pure-form-stacked">
	      <fieldset>
		<button type="submit" class="btn-red pure-button">Reset</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>	
    </div> <!-- end if -->
  </div> <!-- end setting -->
</div> <!-- end l-content -->
<div class="footer l-box">
    <p>
        Aqua-tan Smart Light by @omzn 2017-2018 / All rights researved
    </p>
</div>
<script type="text/javascript">

$('form#config').submit(
    function(ev) {
	$.post('/config',
                "enable="+$('#enable').prop('checked').toString()
               +"&on_h="+$('#on_h').val()
               +"&on_m="+$('#on_m').val()
               +"&off_h="+$('#off_h').val()
               +"&off_m="+$('#off_m').val()
               +"&max_power="+$('#max_power').val()
               +"&dim="+$('#dim').val(),
	       read,"json");
	$('#sch_sub').prop('disabled', true);
	return false;
    });

function read(json) {
    if (json.enable == "true") {
	$('#enable').prop("checked",true);
    } else {
	$('#enable').prop("checked",false);
    }
    $('#on_h').val(json.on_h);
    $('#on_m').val(json.on_m);
    $('#off_h').val(json.off_h);
    $('#off_m').val(json.off_m);
    $('#max_power').val(json.max_power);
    $('#dim').val(json.dim);
}

function update() {
    $.getJSON('/status',function(json){
	if ( json.status == 3) {
	    $('#ls').html("Turn ON");
        } else if (json.status == 2) {
	    $('#ls').html("Turn OFF");
	} else if (json.status == 0) {
	    $('#ls').html("OFF");
	} else if (json.status == 1) {
	    $('#ls').html("ON");
        }
        $('#lv').html(json.power.toString());
    });
}

function confset() {
    $.getJSON('/config',function(json){
	read(json);
	if($('#enable').is(":checked")){
	    $('#on_h').prop('disabled', false);
	    $('#on_m').prop('disabled', false);
	    $('#off_h').prop('disabled', false);
	    $('#off_m').prop('disabled', false);
	} else {
	    $('#sch_sub').prop('disabled', true);
	    $('#on_h').prop('disabled', true);
	    $('#on_m').prop('disabled', true);
	    $('#off_h').prop('disabled', true);
	    $('#off_m').prop('disabled', true);
	}

    });
}

$(function() {
    
    $('#enable').click(function(){
	if($(this).is(":checked")){
	    $('#on_h').prop('disabled', false);
	    $('#on_m').prop('disabled', false);
	    $('#off_h').prop('disabled', false);
	    $('#off_m').prop('disabled', false);
	    $.post('/config',
		   "enable="+$('#enable').prop('checked').toString(),
		   read,"json");
	} else if($(this).is(":not(:checked)")){
	    $('#sch_sub').prop('disabled', true);
	    $('#on_h').prop('disabled', true);
	    $('#on_m').prop('disabled', true);
	    $('#off_h').prop('disabled', true);
	    $('#off_m').prop('disabled', true);
	    $.post('/config',
		   "enable="+$('#enable').prop('checked').toString(),
		   read,"json");
	}
    });

    $('#sch_sub').prop('disabled', true);

    $('#on_h').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });
    
    $('#on_m').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#off_h').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#off_m').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#max_power').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#dim').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    confset();
    update();
    setInterval("update()",15000);
});

</script>
</body>
</html>
